<script>
    /**
     * SETUPALPHA PORTFOLIO WIDGET INTEGRATION
     * Place this script in your Shopify Theme (e.g., in theme.liquid before </body> 
     * OR in the specific Page template liquid file).
     */
    document.addEventListener('DOMContentLoaded', function () {

        // 1. CONFIGURATION: UPDATE THIS SELECTOR!
        // Creates a reference to the iframe. Usually iframes have a specific ID or source.
        // If you pasted the iframe code, look for <iframe id="portfolio-architect" ...>
        const iframeSelector = 'iframe[src*="setupalpha"]';

        const iframe = document.querySelector(iframeSelector);
        if (!iframe) {
            console.warn("SetupAlpha Widget: Iframe not found with selector: " + iframeSelector);
            return;
        }

        // 2. RESIZE LISTENER (Prevents "Cutting Off")
        // Listens for messages from the App saying "I am now 5000px tall"
        window.addEventListener('message', function (e) {
            if (e.data && e.data.type === 'resize' && e.data.height) {
                iframe.style.height = e.data.height + 'px';
            }
        });

        // 3. SCROLL TRACKER (Enable Sticky Sidebar)
        // Tells the App "User has scrolled down 500px", so the App can move the sidebar.
        let ticking = false;
        function sendScroll() {
            if (!iframe) return;

            const rect = iframe.getBoundingClientRect();
            // rect.top is the distance from the viewport top to the iframe top.
            // If rect.top is negative, it means we have scrolled PAST the start of the iframe.
            const offset = rect.top < 0 ? Math.abs(rect.top) : 0;

            // Add a little padding (24px) so it doesn't touch the exact edge
            const safeOffset = offset > 0 ? offset + 24 : 0;

            if (iframe.contentWindow) {
                iframe.contentWindow.postMessage({ type: 'scroll', offset: safeOffset }, '*');
            }
            ticking = false;
        }

        window.addEventListener('scroll', function () {
            if (!ticking) {
                window.requestAnimationFrame(sendScroll);
                ticking = true;
            }
        });

        // Initial check in case we load already scrolled
        sendScroll();
    });
</script>